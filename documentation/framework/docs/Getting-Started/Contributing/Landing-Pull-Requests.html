<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Landing pull requests</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <link rel="stylesheet" href="../../styles.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,700;1,300;1,400&display=swap" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <nav class="right">
    <ul>
      <li style="display: inline;"> <a href="https://github.com/rapid7/metasploit-framework/tree/master/documentation/modules" target="_blank">Module Docs</a></li>
      <li style="display: inline;"><a href="https://rapid7.github.io/metasploit-framework/api/" target="_blank">API</a></li>
      <li style="display: inline;"><a href="https://github.com/rapid7/metasploit-framework" target="_blank">Metasploit GitHub</a></li>
    </ul>
  </nav>
</head>
<body>

<div id="main-outer-box">

<div id="my-header">
  <a href="../../index.html">Metasploit Framework</a>
</div>

<div id="trunk-box">

<div id="nav-box">
<p>Contents:</p>
<ul>
<li>Getting-Started/
<ul>
<li><a href="../.././Getting-Started/setting-up-metasploit-dev-enviroment.html">Setting up a Metasploit Developer Environment</a></li>
<li>Contributing/
<ul>
<li><a href="Code-Of-Conduct.html">Contributor Code of Conduct</a></li>
<li><a href="Contributing-to-Metasploit.html">Contributing to Metasploit</a></li>
<li><a href="Guidelines-for-Accepting-Modules-and-Enhancements.html">Guidelines for accepting modules and enhancements</a></li>
<li><a href="Adding-Release-Notes-to-PRs.html">Adding release notes to PRs</a></li>
<li><strong>Landing pull requests</strong></li>
<li><a href="Keeping-in-sync-with-rapid7-master.html">Keep in sync with master</a></li>
<li><a href="How-to-add-and-update-gems-in-metasploit-framework.html">How to add and update gems</a></li>
<li><a href="How-to-deprecate-a-Metasploit-module.html">How to deprecate a Metasploit module</a></li>
<li><a href="Rolling-back-merges.html">Roll back merges</a></li>
<li><a href="Style-Tips.html">Style Tips</a></li>
<li><a href="Reporting-a-Bug.html">Metasploit Bug Reporting</a></li>
<li><a href="markdown-cheat-sheet.html">Markdown Cheat Sheet</a></li>
</ul></li>
<li>Kali-Linux/
<ul>
<li><a href="../.././Getting-Started/Kali-Linux/How-to-get-Oracle-Support-working-with-Kali-Linux.html">Use Oracle support with Kali Linux</a></li>
</ul></li>
<li><a href="../.././Getting-Started/Contact.html">Contact</a></li>
</ul></li>
<li>Modules/
<ul>
<li><a href="../.././Modules/How-to-use-a-Metasploit-module-appropriately.html">Properly use a module</a></li>
<li><a href="../.././Modules/Module-Documentation.html">Module documentation</a></li>
<li><a href="../.././Modules/Module-Reference-Identifiers.html">Reference Identifiers</a></li>
<li><a href="../.././Modules/Handling-Module-Failures-with-fail_with.html">Handing modules failures with <code>fail_with</code></a></li>
<li><a href="../.././Modules/Running-Private-Modules.html">Run private modules</a></li>
<li><a href="../.././Modules/How-to-do-reporting-or-store-data-in-module-development.html">How to do reporting and store data during module development</a></li>
<li><a href="../.././Modules/Using-ReflectiveDll-Injection.html">Using the ReflectiveDll loader in a Metasploit module</a></li>
<li>Write-Modules/
<ul>
<li><a href="../.././Modules/Write-Modules/How-to-write-a-module-using-HttpServer-and-HttpClient.html">How to write a module using HTTPServer and HTTPClient</a></li>
<li><a href="../.././Modules/Write-Modules/Writing-External-Metasploit-Modules.html">Writing External Metasploit Modules</a></li>
<li><a href="../.././Modules/Write-Modules/get-started-writing-auxillary-module.html">Get started with writing an auxiliary module</a></li>
<li><a href="../.././Modules/Write-Modules/How-to-write-a-HTTP-LoginScanner-Module.html">How to write a HTTP LoginScanner Module</a></li>
<li><a href="../.././Modules/Write-Modules/Writing-External-Python-Modules.html">Writing Python Modules for Metasploit</a></li>
<li><a href="../.././Modules/Write-Modules/get-started-writing-post-module.html">Get started with writing a post module</a></li>
<li><a href="../.././Modules/Write-Modules/Writing-External-GoLang-Modules.html">Writing external GoLang modules</a></li>
<li><a href="../.././Modules/Write-Modules/login-scanner.html">Create a Login Scanner Module</a></li>
<li><a href="../.././Modules/Write-Modules/http-login-scanner.html">How to write a HTTP LoginScanner Module</a></li>
</ul></li>
</ul></li>
<li>Exploits/
<ul>
<li><a href="../.././Exploits/Information-About-Unmet-Browser-Exploit-Requirements.html">Unmet browser exploit requirements</a></li>
<li><a href="../.././Exploits/How-to-use-Powershell-in-an-exploit.html">Add PowerShell mixin to an exploit</a></li>
<li><a href="../.././Exploits/How-to-clean-up-files-using-FileDropper.html">How to clean up files using FileDropper</a></li>
<li><a href="../.././Exploits/How-to-use-PhpEXE-to-exploit-an-arbitrary-file-upload-bug.html">PhpEXE arbitrary file upload</a></li>
<li><a href="../.././Exploits/How-to-use-Railgun-for-Windows-post-exploitation.html">Use Railgun for Windows</a></li>
<li><a href="../.././Exploits/How-to-use-command-stagers.html">Use command stagers</a></li>
<li><a href="../.././Exploits/exploit-ranking.html">Exploit Ranking</a></li>
<li>Write-Exploits/
<ul>
<li><a href="../.././Exploits/Write-Exploits/writing-exploits.html">Get Started Writing an Exploit</a></li>
<li><a href="../.././Exploits/Write-Exploits/How-to-use-WbemExec-for-a-write-privilege-attack-on-Windows.html">Write a privilege attack with WbemExec</a></li>
<li><a href="../.././Exploits/Write-Exploits/How-to-Use-the-FILEFORMAT-mixin-to-create-a-file-format-exploit.html">How to use the FILEFORMAT mixin</a></li>
<li><a href="../.././Exploits/Write-Exploits/How-to-write-a-browser-exploit-using-HttpServer.html">How to write a browser exploit using HTTP Server</a></li>
<li><a href="../.././Exploits/Write-Exploits/How-to-write-a-browser-exploit-using-BrowserExploitServer.html">Write a browser exploit with BrowserExploitServer</a></li>
</ul></li>
</ul></li>
<li>Payloads/
<ul>
<li><a href="../.././Payloads/how-payloads-work.html">How Payloads Work</a></li>
<li><a href="../.././Payloads/payload-debugging.html">Payload Debugging</a></li>
<li><a href="../.././Payloads/Payload-UUID.html">Payload UUID</a></li>
<li>Meterpreter/
<ul>
<li><a href="../.././Payloads/Meterpreter/about-meterpreter.html">About Meterpreter</a></li>
<li><a href="../.././Payloads/Meterpreter/meterpreter-configuration.html">Meterpreter Configuration</a></li>
<li><a href="../.././Payloads/Meterpreter/transport-control.html">Transport Control</a></li>
<li><a href="../.././Payloads/Meterpreter/Meterpreter-Reliable-Network-Communication.html">Reliable Network Communication</a></li>
<li><a href="../.././Payloads/Meterpreter/Meterpreter-Unicode-Support.html">Unicode Support</a></li>
<li><a href="../.././Payloads/Meterpreter/Meterpreter-HTTP-Communication.html">Meterpreter HTTP communication</a></li>
<li><a href="../.././Payloads/Meterpreter/Meterpreter-Sleep-Control.html">Sleep Control</a></li>
<li><a href="../.././Payloads/Meterpreter/Meterpreter-Paranoid-Mode.html">Paranoid Mode</a></li>
<li><a href="../.././Payloads/Meterpreter/The-ins-and-outs-of-HTTP-and-HTTPS-communications-in-Meterpreter-and-Metasploit-Stagers.html">HTTP and HTTPS communication</a></li>
<li><a href="../.././Payloads/Meterpreter/Python-Extension.html">Python Extension</a></li>
</ul></li>
<li>msfvenom/
<ul>
<li><a href="../.././Payloads/msfvenom/How-to-use-msfvenom.html">How to use msfvenom</a></li>
</ul></li>
<li>Shell/
<ul>
<li><a href="../.././Payloads/Shell/How-to-use-a-reverse-shell-in-Metasploit.html">How to use a reverse shell</a></li>
</ul></li>
</ul></li>
<li>Utilities/
<ul>
<li><a href="../.././Utilities/complier-windows-c.html">How to use Metasploit Framework Compiler Windows to compile C code</a></li>
<li><a href="../.././Utilities/oracle-support-kali-linux.html">Oracle Support working with Kali Linux</a></li>
<li><a href="../.././Utilities/How-to-zip-files-with-Msf-Util-EXE.to_zip.html">How to zip files with Msf::Util::EXE.to_zip</a></li>
<li><a href="../.././Utilities/How-to-use-the-Msf-Exploit-Remote-Tcp-mixin.html">How to use the Msf::Exploit::Remote::Tcp mixin</a></li>
</ul></li>
<li>Evasion-and-Obfuscation/
<ul>
<li><a href="../.././Evasion-and-Obfuscation/obfuscation-crandomizer.html">CRandomizer</a></li>
<li><a href="../.././Evasion-and-Obfuscation/How-to-obfuscate-JavaScript-in-Metasploit.html">Obfuscate JavaScript</a></li>
<li><a href="../.././Evasion-and-Obfuscation/How-to-use-Metasploit-Framework-Obfuscation-CRandomizer.html">How to use CRandomizer</a></li>
</ul></li>
<li>API/
<ul>
<li><a href="../.././API/Metasploit-Web-Service.html">Metasploit web service</a></li>
</ul></li>
<li>Debugging/
<ul>
<li><a href="../.././Debugging/How-to-log-in-Metasploit.html">Log Files in Metasploit</a></li>
<li><a href="../.././Debugging/Why-CVE-is-not-available.html">Why is a CVE Not Available?</a></li>
</ul></li>
<li><a href="../.././external-resources.html">External Resources</a></li>
</ul>

</div>

<div id="article-box">

<div id="header-nav-bar">
<div><a href="Adding-Release-Notes-to-PRs.html">←prev</a></div><div class="nav-bar-push"><a href="Keeping-in-sync-with-rapid7-master.html">next→</a></div>
</div>

<div id="article-content">
<header id="title-block-header">
<h1 class="title">Landing pull requests</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#the-short-story">The short story</a></li>
<li><a href="#handy-git-aliases">Handy Git aliases</a></li>
<li><a href="#branching-from-prs">Branching from PRs</a>
<ul>
<li><a href="#checking-out-branches-from-a-remote-forked-repo-in-your-forked-repo">Checking out branches from a remote forked repo in your forked repo</a></li>
</ul></li>
<li><a href="#making-changes">Making changes</a></li>
<li><a href="#collaboration-between-contributors">Collaboration between contributors</a></li>
<li><a href="#landing-to-upstream">Landing to upstream</a></li>
<li><a href="#post-merge">Post-Merge</a></li>
<li><a href="#cross-linking-prs-bugs-and-commits">Cross-linking PRs, Bugs, and Commits</a></li>
<li><a href="#merge-conflicts">Merge conflicts</a></li>
<li><a href="#questions-and-corrections">Questions and Corrections</a></li>
</ul>
</nav>
<blockquote>
<p>This page is meant for Committers. If you are unsure whether you are a committer, you are not.**</p>
</blockquote>
<p>Metasploit is built incrementally by the community through GitHub’s <a href="https://github.com/rapid7/metasploit-framework/pulls">Pull Request</a> mechanism. Submitting pull requests (or PRs) is already discussed in the <a href="https://github.com/rapid7/metasploit-framework/wiki/Setting-Up-a-Metasploit-Development-Environment">Dev environment setup</a> documentation. It’s important to realize that PRs are a feature of GitHub, not git, so this document will take a look at how to get your git environment to deal with them sensibly.</p>
<h1 id="the-short-story">The short story</h1>
<ul>
<li><p>Configure your git environment as described <a href="https://github.com/rapid7/metasploit-framework/wiki/Setting-Up-a-Metasploit-Development-Environment#keeping-in-sync">here</a>.</p></li>
<li><p>Add the <code>fetch = +refs/pull/*/head:refs/remotes/upstream/pr/*</code> line to your <code>.git/config</code>.</p></li>
<li><p>Add your signing key <code>git config --global user.signingkey</code></p>
<ul>
<li><p>Use <code>gpg --list-keys</code> to view your available keys. Note that on certain systems you may need to replace <code>gpg</code> with <code>gpg2</code>. Sample output can be seen below:</p>
<pre><code>pub   rsa4096 2020-04-07 [SC]
  3198961E148FF5E527E31A5FD35E05C0F2B81E83
uid           [ultimate] Grant Willcox &lt;gwillcox@rapid7.com&gt;
sub   rsa4096 2020-04-07 [E]</code></pre></li>
<li><p>Set the GPG key as your signing key. To set the key shown above as the signing key for all repositories, one would execute:</p>
<pre><code>git config --global user.signingkey 3198961E148FF5E527E31A5FD35E05C0F2B81E83</code></pre></li>
</ul></li>
<li><p>When merging code from a pull request, always, always <code>merge -S --no-ff --edit</code>, and write a meaningful <a href="http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html">50/72</a> commit message that references the original PR as <code>#1234</code> (not PR1234, not PR#1234, not 1234). For example, your message should look like this:</p>
<pre><code>Land #1234, a whizbang bug fix

Adds a whiz to the existing bang. It appears that without this,
bad things can occasionally happen. Thanks @mcfakepants!

Fixes #1024, also see #999.</code></pre>
<ul>
<li>The <code>-S</code> flag indicates that you’re going to sign the merge with your PGP/GPG key, which is a nice assurance that you’re really you.</li>
<li>The <code>--no-ff</code> flag indicates that you want to create a merge commit no matter what, even if the merge would normally be resolved as a fast forwards. This ensure that all changes have a commit associated with them.</li>
<li>The <code>--edit</code> flag will drop you into your default editor (normally vim), and will allow you to edit the commit message so that it conforms to Metasploit standards, rather than sticking with git’s pre-generated commit message which does not.</li>
</ul></li>
<li><p>Note that the <code>--no-ff</code> flag should be used both for PRs that go back to a contributor’s branch as well as PRs that land in Metasploit’s master branch.</p></li>
<li><p>If you’re making changes (often the case), merge to a landing branch, then merge <strong>that</strong> branch to upstream/master with the <code>-S --no-ff --edit</code> options.</p></li>
</ul>
<h1 id="handy-git-aliases">Handy Git aliases</h1>
<p>Check out <a href="https://gist.github.com/todb-r7/3fbee1a9e7b36d82ca55">this gist</a> that automates (mostly) landing pull requests, signing the merge commit, all while rarely losing a race with other committers. # Fork and clone</p>
<p>First, fork and clone the <code>rapid7/metasploit-framework</code> repo, <a href="https://help.github.com/articles/fork-a-repo">following these instructions</a>. I like using ssh with <code>~/.ssh/config</code> aliases <a href="https://github.com/rapid7/metasploit-framework/wiki/Setting-Up-a-Metasploit-Development-Environment#wiki-ssh">as described here</a>, but the https method will work, too.</p>
<p>Once this is done, you will have a remote repository called “origin,” which points to your forked repository on GitHub. You will be doing most of your work in your own fork of Metasploit, even if you have commit rights to Rapid7’s fork. Now, we’re going to add an “upstream” repository to talk to the Rapid7 repository.</p>
<p>In addition, we’re going to add a magical line to the config file that will let us see all pull requests against the Rapid7 repo (both open and closed). Note that this will take a minute since you’re adding some hundreds of megs to your clone’s refs.</p>
<p>So, open up <code>metasploit-framework/.git/config</code> with your favorite editor, add an upstream remote, and add the pull request refs for both your and Rapid7’s forks. In the end, you should have a section that started off like this:</p>
<pre class="config"><code>[remote &quot;upstream&quot;]
  fetch = +refs/heads/*:refs/remotes/upstream/*
  fetch = +refs/pull/*/head:refs/remotes/upstream/pr/*
  url = https://github.com/rapid7/metasploit-framework</code></pre>
<p>And now it looks like this:</p>
<pre class="config"><code>[remote &quot;upstream&quot;]
  fetch = +refs/heads/*:refs/remotes/upstream/*
  fetch = +refs/pull/*/head:refs/remotes/upstream/pr/*
  url = git@github.com:rapid7/metasploit-framework.git
[remote &quot;origin&quot;]
  fetch = +refs/heads/*:refs/remotes/origin/*
  fetch = +refs/pull/*/head:refs/remotes/origin/pr/*
  url = https://github.com/YOURNAME/metasploit-framework</code></pre>
<p>Some people like to copy these over into remotes named “rapid7” and “yourusername” just so they don’t have to remember about “origin” and “upstream,” but for this doc, we’ll just assume you have “origin” and “upstream” defined like this.</p>
<p>Now, you can git fetch the remote PRs. This will take a little bit, since we have a couple dozen MBs of pull request data. Storage is cheap, though, right?</p>
<pre><code>$ git fetch --all
Fetching todb-r7
remote: Counting objects: 13, done.
remote: Compressing objects: 100% (1/1), done.
remote: Total 7 (delta 6), reused 7 (delta 6)
Unpacking objects: 100% (7/7), done.
From https://github.com/todb-r7/metasploit-framework
 * [new ref]         refs/pull/1/head -&gt; origin/pr/1
 * [new ref]         refs/pull/2/head -&gt; origin/pr/2
Fetching upstream
remote: Counting objects: 91, done.
remote: Compressing objects: 100% (29/29), done.
remote: Total 59 (delta 47), reused 42 (delta 30)
Unpacking objects: 100% (59/59), done.
From https://github.com/rapid7/metasploit-framework
 [... bunches of tags and PRs ...]
 * [new ref]         refs/pull/1701/head -&gt; upstream/pr/1701
 * [new ref]         refs/pull/1702/head -&gt; upstream/pr/1702</code></pre>
<p>You can <code>git fetch</code> a remote any time, and you’ll get access to the latest changes to all branches and pull requests.</p>
<h1 id="branching-from-prs">Branching from PRs</h1>
<p>A manageable strategy for dealing with outstanding PRs is to start pre-merge testing on the pull request in isolation. For example, to work on PR #1217, we would:</p>
<pre><code>$ git checkout upstream/pr/1217
Note: checking out &#39;upstream/pr/1217&#39;.

You are in &#39;detached HEAD&#39; state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -b with the checkout command again. Example:

  git checkout -b new_branch_name

HEAD is now at 9e499e5... Make BindTCP test more robust
((no branch)) todb@mazikeen:~/git/rapid7/metasploit-framework
```
```
$ git checkout -b landing-1217</code></pre>
<p>Now, we’re on a local branch identical to the original pull request, and can move on from there. We can make our changes, isolated from master, and then either send them back to the contributor (this requires looking up the original contributor’s GitHub username and branch name on GitHub), or if there aren’t any changes or the changes are trivial, we can land them (if you have committer rights to Rapid7’s repo, this is where you land them to the upstream repo).</p>
<p>In this particular case with PR #1217, I did want to send some changes back to the contributor.</p>
<p><strong>Important</strong>: If the codebase the contributor’s PR is based on is severely outdated (e.g., they branched off an outdated <code>master</code>), you should not test their PR in isolation as described above. Instead, you should create a test branch that is identical to the latest codebase, merge the contributor’s PR into the test branch, and then start your testing.</p>
<p>Here’s an example with #6954 (your workflow may vary):</p>
<pre><code>$ git checkout upstream/master 
Note: checking out &#39;upstream/master&#39;.

You are in &#39;detached HEAD&#39; state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -b with the checkout command again. Example:

  git checkout -b &lt;new-branch-name&gt;

HEAD is now at afbeb2b... Land #7023, fixes for swagger exploit
$ git merge --no-ff --no-edit upstream/pr/6954
Merge made by the &#39;recursive&#39; strategy.
 modules/exploits/windows/local/payload_inject.rb | 5 +++++
 1 file changed, 5 insertions(+)
[*] Running msftidy.rb in .git/hooks/post-merge mode
--- Checking new and changed module syntax with tools/dev/msftidy.rb ---
modules/exploits/windows/local/payload_inject.rb - msftidy check passed
------------------------------------------------------------------------</code></pre>
<p>This ensures that the contributor’s PR is being tested against the latest codebase and not an outdated one. <strong>If you do not do this</strong>, when you land the PR, you may end up breaking Metasploit.</p>
<p>Note that the example above will leave you in a detached HEAD state. This is fine if you just want to test the module in question, however if you want to make any changes, don’t forget to make a new branch. For the example above this could be done by running the following command:</p>
<pre><code>git checkout -b land-6594</code></pre>
<h2 id="checking-out-branches-from-a-remote-forked-repo-in-your-forked-repo">Checking out branches from a remote forked repo in your forked repo</h2>
<p>After your <code>.git/config</code> is set up per the above, and you successfully run <code>git fetch --all</code>, you are two steps away from being able to check out a branch from a contributor’s forked repo.</p>
<p>You need to add their fork once as a remote: <code>git remote add OTHER_USER git://github.com/OTHER_USER/metasploit-framework.git</code>. Now pull down the latest from them: <code>git fetch OTHER_USER</code>. Now you can check out branches from OTHER_USER per usual, e.g. <code>git checkout bug/foo</code>.</p>
<h1 id="making-changes">Making changes</h1>
<pre><code>$ gvim .gitignore
[... make some changes and some commits ...]
(landing-1217) todb@mazikeen:~/git/rapid7/metasploit-framework
$ git checkout -b pr1217-fix-gitignore-conflict
Switched to a new branch &#39;pr1217-fix-gitignore-conflict&#39;
(pr1217-fix-gitignore-conflict) todb@mazikeen:~/git/rapid7/metasploit-framework
$ git push origin pr1271-fix-gitignore-conflict
(pr1217-fix-gitignore-conflict) todb@mazikeen:~/git/rapid7/metasploit-framework
$ git pr-url schierlm javapayload-maven
Created new window in existing browser session.</code></pre>
<p>This sequence does a few things after editing <code>.gitconfig</code>. It creates another copy of landing-1217 (which is itself a copy of upstream/pr/1217)). Next, I push those changes to my branch (todb-r7, aka “origin”). Finally, I have a mighty <a href="https://gist.github.com/todb-r7/5438391">.gitconfig alias here</a> to open a browser window to send a pull request to the original contributor’s branch (you will want to edit yours to reflect your real GitHub username, of course).</p>
<pre><code>pr-url = !&quot;echo https://github.com/YOURNAME/metasploit-framework/pull/new/HISNAME:HISBRANCH...YOURBRANCH&quot;</code></pre>
<p>Filling in the blanks (provided by the original PR’s information from GitHub) gets me:</p>
<pre><code>https://github.com/todb-r7/metasploit-framework/pull/new/schierlm:javapayload-maven...pr1217-fix-gitignore-conflict</code></pre>
<p>I opened that in a browser, and ended up with https://github.com/schierlm/metasploit-framework/pull/1 . Once <span class="citation" data-cites="schierlm">@schierlm</span> landed it on his branch (again, using <code>git merge --no-ff</code> and a short, informational merge commit message), all I (or anyone) had to do was <code>git fetch</code> to get the change reflected in upstream/pr/1217, and then the integration of the PR could continue.</p>
<h1 id="collaboration-between-contributors">Collaboration between contributors</h1>
<p>Note the important bit here: <strong>you do not need commit rights to Rapid7 to branch pull requests</strong>. If Alice knows a solution to Bob’s pull request that Juan pointed out, it is <strong>easy</strong> for Alice to provide that solution by following the procedure above. <code>git blame</code> will still work correctly, commit histories will all be accurate, everyone on the pull request will be notified of Alice’s changes, and Juan doesn’t have to wait around for Bob to figure out how to use <code>send_request_cgi()</code> or whatever the problem was. The hardest part is remembering how to construct the pull request to Bob – lucky for you, <a href="https://gist.github.com/todb-r7/5438391">this .git/config alias</a> makes that part pretty push-button.</p>
<h1 id="landing-to-upstream">Landing to upstream</h1>
<p>Back to PR #1217. Turns out, my change was enough to land the original chunk of work. So, someone else (<span class="citation" data-cites="jlee-r7">@jlee-r7</span>) was able to to do something like this:</p>
<pre><code>$ git fetch upstream
remote: Counting objects: 12, done.
remote: Compressing objects: 100% (2/2), done.
remote: Total 7 (delta 5), reused 7 (delta 5)
Unpacking objects: 100% (7/7), done.
From https://github.com/rapid7/metasploit-framework
   9e499e5..263e967  refs/pull/1651/head -&gt; upstream/pr/1651</code></pre>
<p>This all looked good, so he could land this to Rapid7’s repo with:</p>
<pre><code>$ git checkout -b upstream-master --track upstream/master
$ git merge -S --no-ff --edit landing-1217
$ git push upstream upstream-master:master</code></pre>
<p>Or, if he already have upstream-master checked out:</p>
<pre><code>$ git checkout upstream-master
$ git rebase upstream/master
$ git merge -S --no-ff --edit landing-1217
$ git push upstream upstream-master:master</code></pre>
<p>The <code>--edit</code> is optional if we have our editor configured correctly in <code>$HOME/.gitconfig</code>. The point here is that we <em>always</em> want a merge commit, and we <em>never</em> want to use the (often useless) default merge commit message. For #1217, this was changed to:</p>
<pre class="commit"><code>Land #1217, java payload build system refactor
</code></pre>
<p>Note that you should rebase <em>before</em> landing – otherwise, your merge commit will be lost in the rebase.</p>
<p>Finally, the -S indicates we are going to sign the merge, using our GPG key. This is a nice way to prove in a secure way that this merge is, in fact, coming from you, and not someone impersonating you. For more on signing merges, see <a href="http://mikegerwitz.com/papers/git-horror-story.html">A Git Horror Story: Repository Integrity With Signed Commits</a>.</p>
<p>To set yourself up for signing, your .gitconfig (or metasploit-framework/git/.config) file should have these entries:</p>
<pre><code>[user]
name = Your Name
email = your@email.xxx
signingkey = DEADBEEF # Must match exactly with your key for &quot;Your Name &lt;your@email.xxx&gt;&quot;
[alias]
c = commit -S --edit
m = merge -S --no-ff --edit</code></pre>
<p>People with commit rights to rapid7/metasploit-framework will have their <a href="https://github.com/rapid7/metasploit-framework/wiki/Committer-Keys">keys listed here</a>.</p>
<h1 id="post-merge">Post-Merge</h1>
<p>After a pull request has been merged, release notes should be added to the pull request in the form of a comment. These release notes will automatically be extracted and used as documentation when creating the <a href="https://help.rapid7.com/metasploit/release-notes/">metasploit release notes</a>.</p>
<p>Release note examples:</p>
<ul>
<li><a href="https://github.com/rapid7/metasploit-framework/pull/12873#issuecomment-577247684">12873 Release notes</a></li>
<li><a href="https://github.com/rapid7/metasploit-framework/pull/12831#issuecomment-577399914">12831 Release notes</a></li>
</ul>
<p>The <a href="https://github.com/rapid7/metasploit-framework/issues?utf8=%E2%9C%93&amp;q=label%3Arn-no-release-notes+">rn-no-release-notes</a> label must be added if there are no release notes for the merged pull request.</p>
<h1 id="cross-linking-prs-bugs-and-commits">Cross-linking PRs, Bugs, and Commits</h1>
<p>TODO: Update in this new post-Redmine, GitHub issues world</p>
<h1 id="merge-conflicts">Merge conflicts</h1>
<p>The nice thing about this strategy is that you can test for merge conflicts straight away. You’d use a sequence like:</p>
<pre><code>git checkout upstream/pr/1234
git checkout -b landing-1234
git checkout master
git checkout -b master-temp
git merge landing-1234 master-temp</code></pre>
<p>If that works, great, you know you don’t have any merge conflicts right now.</p>
<h1 id="questions-and-corrections">Questions and Corrections</h1>
<p>Reach out in #contributors on <a href="https://metasploit.com/slack">Metasploit Slack</a>, or by e-mailing msfdev at metasploit dot com.</p>

</div> <!-- article-content -->

<div id="footer-nav-bar">
<div><a href="Adding-Release-Notes-to-PRs.html">←prev</a></div><div class="nav-bar-push"><a href="Keeping-in-sync-with-rapid7-master.html">next→</a></div>
</div>

</div> <!-- article-box -->

</div> <!-- trunk-box -->

<div id="my-footer">
<p>Copyright <a href="https://metasploit.com/">Metasploit</a>, 2020</p>
<p><a href="https://join.slack.com/t/metasploit/shared_invite/enQtOTMxMjg5ODY3NDYxLTYyZTVlNDM1ZTI3ZGQ0YTQ0NmI1YjgxMGEwYzFhOWNiZWQ4NDNmNTE1MWNiYzJhMzgwMGY0ZWY2NTY0MjA2M2I">Slack team - metasploit.slack.com</a></p>
<p><a href="https://twitter.com/metasploit">#twitter handle - @metasploit</a></p>
<p><a href="mailto:msfdev@metasploit.com">development questions - msfdev [ @ ] metasploit.com</a></p><br/>
<a href="Landing-Pull-Requests.md">Pandoc-Markdown source for this page</a><br/>
(Docs processed by
<a href="http://www.unexpected-vortices.com/sw/rippledoc/index.html">Rippledoc</a>.)
</div> <!-- my-footer -->

</div> <!-- main-outer-box -->

</body>
</html>
