<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Metasploit Versions 4,5" />
  <title>How to use the Msf::Exploit::Remote::Tcp mixin</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../styles.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,700;1,300;1,400&display=swap" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <nav class="right">
    <ul>
      <li style="display: inline;"> <a href="https://github.com/rapid7/metasploit-framework/tree/master/documentation/modules" target="_blank">Module Docs</a></li>
      <li style="display: inline;"><a href="https://rapid7.github.io/metasploit-framework/api/" target="_blank">API</a></li>
      <li style="display: inline;"><a href="https://github.com/rapid7/metasploit-framework" target="_blank">Metasploit GitHub</a></li>
    </ul>
  </nav>
</head>
<body>

<div id="main-outer-box">

<div id="my-header">
  <a href="../index.html">Metasploit Framework</a>
</div>

<div id="trunk-box">

<div id="nav-box">
<p>Contents:</p>
<ul>
<li>Getting-Started/
<ul>
<li><a href=".././Getting-Started/Installing-Metasploit.html">Installing Metasploit</a></li>
<li><a href=".././Getting-Started/setting-up-metasploit-dev-enviroment.html">Setting up a Metasploit Developer Environment</a></li>
<li>Contributing/
<ul>
<li><a href=".././Getting-Started/Contributing/Code-Of-Conduct.html">Contributor Code of Conduct</a></li>
<li><a href=".././Getting-Started/Contributing/Contributing-to-Metasploit.html">Contributing to Metasploit</a></li>
<li><a href=".././Getting-Started/Contributing/Guidelines-for-Accepting-Modules-and-Enhancements.html">Guidelines for accepting modules and enhancements</a></li>
<li><a href=".././Getting-Started/Contributing/Adding-Release-Notes-to-PRs.html">Adding release notes to PRs</a></li>
<li><a href=".././Getting-Started/Contributing/Landing-Pull-Requests.html">Landing pull requests</a></li>
<li><a href=".././Getting-Started/Contributing/Keeping-in-sync-with-rapid7-master.html">Keep in sync with master</a></li>
<li><a href=".././Getting-Started/Contributing/How-to-add-and-update-gems-in-metasploit-framework.html">How to add and update gems</a></li>
<li><a href=".././Getting-Started/Contributing/How-to-deprecate-a-Metasploit-module.html">How to deprecate a Metasploit module</a></li>
<li><a href=".././Getting-Started/Contributing/Rolling-back-merges.html">Roll back merges</a></li>
<li><a href=".././Getting-Started/Contributing/Style-Tips.html">Style Tips</a></li>
<li><a href=".././Getting-Started/Contributing/Reporting-a-Bug.html">Metasploit Bug Reporting</a></li>
<li><a href=".././Getting-Started/Contributing/markdown-cheat-sheet.html">Markdown Cheat Sheet</a></li>
</ul></li>
<li>Kali-Linux/
<ul>
<li><a href=".././Getting-Started/Kali-Linux/How-to-get-Oracle-Support-working-with-Kali-Linux.html">Use Oracle support with Kali Linux</a></li>
</ul></li>
<li><a href=".././Getting-Started/Contact.html">Contact</a></li>
</ul></li>
<li>Internals/
<ul>
<li><a href=".././Internals/workspaces.html">Workspaces</a></li>
</ul></li>
<li>Modules/
<ul>
<li><a href=".././Modules/How-to-use-a-Metasploit-module-appropriately.html">Properly use a module</a></li>
<li><a href=".././Modules/Module-Documentation.html">Module documentation</a></li>
<li><a href=".././Modules/Module-Reference-Identifiers.html">Reference Identifiers</a></li>
<li><a href=".././Modules/Handling-Module-Failures-with-fail_with.html">Handing modules failures with <code>fail_with</code></a></li>
<li><a href=".././Modules/Running-Private-Modules.html">Run private modules</a></li>
<li><a href=".././Modules/How-to-do-reporting-or-store-data-in-module-development.html">How to do reporting and store data during module development</a></li>
<li><a href=".././Modules/Using-ReflectiveDll-Injection.html">Using the ReflectiveDll loader in a Metasploit module</a></li>
<li>Write-Modules/
<ul>
<li><a href=".././Modules/Write-Modules/How-to-write-a-module-using-HttpServer-and-HttpClient.html">How to write a module using HTTPServer and HTTPClient</a></li>
<li><a href=".././Modules/Write-Modules/Writing-External-Metasploit-Modules.html">Writing External Metasploit Modules</a></li>
<li><a href=".././Modules/Write-Modules/get-started-writing-auxillary-module.html">Get started with writing an auxiliary module</a></li>
<li><a href=".././Modules/Write-Modules/How-to-write-a-HTTP-LoginScanner-Module.html">How to write a HTTP LoginScanner Module</a></li>
<li><a href=".././Modules/Write-Modules/Writing-External-Python-Modules.html">Writing Python Modules for Metasploit</a></li>
<li><a href=".././Modules/Write-Modules/get-started-writing-post-module.html">Get started with writing a post module</a></li>
<li><a href=".././Modules/Write-Modules/Writing-External-GoLang-Modules.html">Writing external GoLang modules</a></li>
<li><a href=".././Modules/Write-Modules/login-scanner.html">Create a Login Scanner Module</a></li>
<li><a href=".././Modules/Write-Modules/http-login-scanner.html">How to write a HTTP LoginScanner Module</a></li>
</ul></li>
</ul></li>
<li>Exploits/
<ul>
<li><a href=".././Exploits/use-exploits.html">Use exploits</a></li>
<li><a href=".././Exploits/Information-About-Unmet-Browser-Exploit-Requirements.html">Unmet browser exploit requirements</a></li>
<li><a href=".././Exploits/How-to-use-Powershell-in-an-exploit.html">Add PowerShell mixin to an exploit</a></li>
<li><a href=".././Exploits/How-to-clean-up-files-using-FileDropper.html">How to clean up files using FileDropper</a></li>
<li><a href=".././Exploits/How-to-use-PhpEXE-to-exploit-an-arbitrary-file-upload-bug.html">PhpEXE arbitrary file upload</a></li>
<li><a href=".././Exploits/How-to-use-Railgun-for-Windows-post-exploitation.html">Use Railgun for Windows</a></li>
<li><a href=".././Exploits/How-to-use-command-stagers.html">Use command stagers</a></li>
<li><a href=".././Exploits/exploit-ranking.html">Exploit Ranking</a></li>
<li>Write-Exploits/
<ul>
<li><a href=".././Exploits/Write-Exploits/writing-exploits.html">Get Started Writing an Exploit</a></li>
<li><a href=".././Exploits/Write-Exploits/How-to-use-WbemExec-for-a-write-privilege-attack-on-Windows.html">Write a privilege attack with WbemExec</a></li>
<li><a href=".././Exploits/Write-Exploits/How-to-Use-the-FILEFORMAT-mixin-to-create-a-file-format-exploit.html">How to use the FILEFORMAT mixin</a></li>
<li><a href=".././Exploits/Write-Exploits/How-to-write-a-browser-exploit-using-HttpServer.html">How to write a browser exploit using HTTP Server</a></li>
<li><a href=".././Exploits/Write-Exploits/How-to-write-a-browser-exploit-using-BrowserExploitServer.html">Write a browser exploit with BrowserExploitServer</a></li>
</ul></li>
</ul></li>
<li>Payloads/
<ul>
<li><a href=".././Payloads/how-payloads-work.html">How Payloads Work</a></li>
<li><a href=".././Payloads/payload-debugging.html">Payload Debugging</a></li>
<li><a href=".././Payloads/Payload-UUID.html">Payload UUID</a></li>
<li>Meterpreter/
<ul>
<li><a href=".././Payloads/Meterpreter/about-meterpreter.html">About Meterpreter</a></li>
<li><a href=".././Payloads/Meterpreter/meterpreter-configuration.html">Meterpreter Configuration</a></li>
<li><a href=".././Payloads/Meterpreter/transport-control.html">Transport Control</a></li>
<li><a href=".././Payloads/Meterpreter/Meterpreter-Reliable-Network-Communication.html">Reliable Network Communication</a></li>
<li><a href=".././Payloads/Meterpreter/Meterpreter-Unicode-Support.html">Unicode Support</a></li>
<li><a href=".././Payloads/Meterpreter/Meterpreter-HTTP-Communication.html">Meterpreter HTTP communication</a></li>
<li><a href=".././Payloads/Meterpreter/Meterpreter-Sleep-Control.html">Sleep Control</a></li>
<li><a href=".././Payloads/Meterpreter/Meterpreter-Paranoid-Mode.html">Paranoid Mode</a></li>
<li><a href=".././Payloads/Meterpreter/The-ins-and-outs-of-HTTP-and-HTTPS-communications-in-Meterpreter-and-Metasploit-Stagers.html">HTTP and HTTPS communication</a></li>
<li><a href=".././Payloads/Meterpreter/Python-Extension.html">Python Extension</a></li>
</ul></li>
<li>msfvenom/
<ul>
<li><a href=".././Payloads/msfvenom/How-to-use-msfvenom.html">How to use msfvenom</a></li>
</ul></li>
<li>Shell/
<ul>
<li><a href=".././Payloads/Shell/How-to-use-a-reverse-shell-in-Metasploit.html">How to use a reverse shell</a></li>
</ul></li>
</ul></li>
<li>Utilities/
<ul>
<li><a href="complier-windows-c.html">How to use Metasploit Framework Compiler Windows to compile C code</a></li>
<li><a href="oracle-support-kali-linux.html">Oracle Support working with Kali Linux</a></li>
<li><a href="How-to-zip-files-with-Msf-Util-EXE.to_zip.html">How to zip files with Msf::Util::EXE.to_zip</a></li>
<li><strong>How to use the Msf::Exploit::Remote::Tcp mixin</strong></li>
</ul></li>
<li>Evasion-and-Obfuscation/
<ul>
<li><a href=".././Evasion-and-Obfuscation/obfuscation-crandomizer.html">CRandomizer</a></li>
<li><a href=".././Evasion-and-Obfuscation/How-to-obfuscate-JavaScript-in-Metasploit.html">Obfuscate JavaScript</a></li>
<li><a href=".././Evasion-and-Obfuscation/How-to-use-Metasploit-Framework-Obfuscation-CRandomizer.html">How to use CRandomizer</a></li>
</ul></li>
<li>API/
<ul>
<li><a href=".././API/Metasploit-Web-Service.html">Metasploit web service</a></li>
<li><a href=".././API/Metasploit-as-a-service.html">Metasploit as a service</a></li>
</ul></li>
<li>Debugging/
<ul>
<li><a href=".././Debugging/How-to-log-in-Metasploit.html">Log Files in Metasploit</a></li>
<li><a href=".././Debugging/Why-CVE-is-not-available.html">Why is a CVE Not Available?</a></li>
</ul></li>
<li><a href=".././external-resources.html">Community Resources</a></li>
</ul>

</div>

<div id="article-box">

<div id="header-nav-bar">
<div><a href="How-to-zip-files-with-Msf-Util-EXE.to_zip.html">←prev</a></div><div class="nav-bar-push"><a href=".././Evasion-and-Obfuscation/obfuscation-crandomizer.html">next→</a></div>
</div>

<div id="article-content">
<header id="title-block-header">
<h1 class="title">How to use the Msf::Exploit::Remote::Tcp mixin</h1>
<p class="author">Metasploit Versions 4,5</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#using-the-mixin">Using the mixin</a></li>
<li><a href="#make-a-connection">Make a connection</a></li>
<li><a href="#sending-data">Sending data</a></li>
<li><a href="#receiving-data">Receiving data</a></li>
<li><a href="#disconnecting">Disconnecting</a></li>
<li><a href="#full-example">Full example</a></li>
</ul>
</nav>
<p>In Metasploit Framework, TCP sockets are implemented as Rex::Socket::Tcp, which extends the built-in Ruby Socket base class. You should always use the Rex socket instead of the native Ruby one because if not, your sockets are not manageable by the framework itself, and of course some features will be missing such as pivoting. The <a href="https://github.com/rapid7/metasploit-framework/blob/master/documentation/developers_guide.pdf">Developer’s Guide</a> in Metasploit’s documentation directory explains how this works pretty well.</p>
<p>For module development, normally you wouldn’t be using Rex directly, so instead you’d be using the Msf::Exploit::Remote::Tcp mixin. The mixin already provides some useful features you don’t really have to worry about during development, such as TCP evasions, proxies, SSL, etc. All you have to do is make that connection, send something, receive something, and you’re done.</p>
<p>Sounds pretty easy, right?</p>
<h2 id="using-the-mixin">Using the mixin</h2>
<p>To use the mixin, simply add the following statement within your module’s <code>class Metasploit3</code> (or <code>class Metasploit4</code>) scope:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb1-1"><a href="#cb1-1"></a>include <span class="dt">Msf</span>::<span class="dt">Exploit</span>::<span class="dt">Remote</span>::<span class="dt">Tcp</span></span></code></pre></div>
<p>When the mixin is included, notice there will be the following datastore options registered under your module:</p>
<ul>
<li><strong>SSL</strong> - Negotiate SSL for outgoing connections.</li>
<li><strong>SSLVersion</strong> - The SSL version used: SSL2, SSL3, TLS1. Default is TLS1.</li>
<li><strong>SSLVerifyMode</strong> - Verification mode: CLIENT_ONCE, FAIL_IF_NO_PEER_CERT, NONE, PEER. Default is PEER.</li>
<li><strong>Proxies</strong> - Allows your module to support proxies.</li>
<li><strong>ConnectTimeout</strong> - Default is 10 seconds.</li>
<li><strong>TCP::max_send_size</strong> - Evasive option. Maxiumum TCP segment size.</li>
<li><strong>TCP::send_delay</strong> - Evasive option. Delays inserted before every send.</li>
</ul>
<p>If you wish to learn how to change the default value of a datastore option, please read “<a href="https://github.com/rapid7/metasploit-framework/wiki/How-to-use-datastore-options#changing-the-default-value-for-a-datastore-option">Changing the default value for a datastore option</a>”</p>
<h2 id="make-a-connection">Make a connection</h2>
<p>To make a connection, simply do the following:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb2-1"><a href="#cb2-1"></a>connect</span></code></pre></div>
<p>When you do this, what happens is that the <code>connect</code> method will call <code>Rex::Socket::Tcp.create</code> to create the socket, and register it to framework. It automatically checks with the RHOST/RPORT datastore options (so it knows where to connect to), but you can also manually change this:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># This connects to metasploit.com</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>connect(<span class="dv">true</span>, {<span class="st">&#39;RHOST&#39;</span>=&gt;<span class="st">&#39;208.118.237.137&#39;</span>, <span class="st">&#39;RPORT&#39;</span>=&gt;<span class="dv">80</span>})</span></code></pre></div>
<p>The <code>connect</code> method will then return the Socket object, which is also accessible globally.</p>
<p>But you see, there’s a little more to it. The <code>connect</code> method can also raise some Rex exceptions that you might want to catch, including:</p>
<ul>
<li><strong>Rex::AddressInUse</strong> - Possible when it actually binds to the same IP/port.</li>
<li><strong>::Errno::ETIMEDOUT</strong> - When Timeout.timeout() waits to long to connect.</li>
<li><strong>Rex::HostUnreachable</strong> - Pretty self-explanatory.</li>
<li><strong>Rex::ConnectionTimeout</strong> - Pretty self-explanatory.</li>
<li><strong>Rex::ConnectionRefused</strong> - Pretty self-explanatory.</li>
</ul>
<p>So to sum it up, ideally when you use the <code>connect</code> method, you should rescue these:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">rescue</span> <span class="dt">Rex</span>::<span class="dt">AddressInUse</span>, ::<span class="dt">Errno</span>::<span class="dt">ETIMEDOUT</span>, <span class="dt">Rex</span>::<span class="dt">HostUnreachable</span>, <span class="dt">Rex</span>::<span class="dt">ConnectionTimeout</span>, <span class="dt">Rex</span>::<span class="dt">ConnectionRefused</span></span></code></pre></div>
<p>If you are curious where all these exceptions are raised, you can find them in <a href="https://github.com/rapid7/metasploit-framework/blob/master/lib/rex/socket/comm/local.rb">lib/rex/socket/comm/local.rb</a>.</p>
<h2 id="sending-data">Sending data</h2>
<p>There are several ways to send data with the Tcp mixin. To make things easier and safer, we recommend just use the <code>put</code> method:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb5-1"><a href="#cb5-1"></a>sock.put <span class="st">&quot;Hello, World!&quot;</span></span></code></pre></div>
<p>The reason the <code>put</code> method is safer is because it does not allow the routine to hang forever. By default, it doesn’t wait, but if you want to make this more flexible, you can do this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">begin</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>    sock.put(<span class="st">&quot;data&quot;</span>, {<span class="st">&#39;Timeout&#39;</span>=&gt;<span class="dv">5</span>})</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="kw">rescue</span> ::<span class="dt">Timeout</span>::<span class="dt">Error</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="co"># You can decide what to do if the writing times out</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="kw">end</span></span></code></pre></div>
<h2 id="receiving-data">Receiving data</h2>
<p>Now, let’s talk about how to receive data. Mainly there are three methods you can use: <code>get_once</code>, <code>get</code>, and <code>timed_read</code>. The difference is that <code>get_once</code> will only try to poll the stream to see if there’s any read data available <strong>one time</strong>, but the <code>get</code> method will keep reading until there is no more. As for <code>timed_read</code>, it’s basically the <code>read</code> method wrapped around with a Timeout.</p>
<p>The following demonstrates how <code>get_once</code> is used:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">begin</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>    buf = sock.get_once</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw">rescue</span> ::<span class="dt">EOFError</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="kw">end</span></span></code></pre></div>
<p>Note that <code>get_once</code> may also return nil if there is no data read, or it hits a EOFError if it receives nil as data. So please make sure you’re catching nil in your module.</p>
<p>The data reading methods can be found in <a href="https://github.com/rapid7/metasploit-framework/blob/master/lib/rex/io/stream.rb">lib/rex/io/stream.rb</a>.</p>
<h2 id="disconnecting">Disconnecting</h2>
<p>To disconnect the connection, simply do:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb8-1"><a href="#cb8-1"></a>disconnect</span></code></pre></div>
<p>It is VERY important you disconnect in an <code>ensure</code> block, obviously to make sure you always disconnect if something goes wrong. If you don’t do this, you may end up with a module that can only one request to the server (that very first one), and the rest are broken.</p>
<h2 id="full-example">Full example</h2>
<p>The following example should demonstrate how you would typically want to use the Tcp mixin:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Sends data to the remote machine</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co">#</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co"># @param data [String] The data to send</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co"># @return [String] The received data</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="kw">def</span> send_recv_once(data)</span>
<span id="cb9-6"><a href="#cb9-6"></a>    buf = <span class="st">&#39;&#39;</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>    <span class="kw">begin</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>        connect</span>
<span id="cb9-9"><a href="#cb9-9"></a>        sock.put(data)</span>
<span id="cb9-10"><a href="#cb9-10"></a>        buf = sock.get_once || <span class="st">&#39;&#39;</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>    <span class="kw">rescue</span> <span class="dt">Rex</span>::<span class="dt">AddressInUse</span>, ::<span class="dt">Errno</span>::<span class="dt">ETIMEDOUT</span>, <span class="dt">Rex</span>::<span class="dt">HostUnreachable</span>, <span class="dt">Rex</span>::<span class="dt">ConnectionTimeout</span>, <span class="dt">Rex</span>::<span class="dt">ConnectionRefused</span>, ::<span class="dt">Timeout</span>::<span class="dt">Error</span>, ::<span class="dt">EOFError</span> =&gt; e</span>
<span id="cb9-12"><a href="#cb9-12"></a>        elog(<span class="st">&quot;</span><span class="ot">#{</span>e.class<span class="ot">}</span><span class="st"> </span><span class="ot">#{</span>e.message<span class="ot">}</span><span class="st">\n</span><span class="ot">#{</span>e.backtrace * <span class="st">&quot;\n&quot;</span><span class="ot">}</span><span class="st">&quot;</span>)</span>
<span id="cb9-13"><a href="#cb9-13"></a>    <span class="kw">ensure</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>        disconnect</span>
<span id="cb9-15"><a href="#cb9-15"></a>    <span class="kw">end</span></span>
<span id="cb9-16"><a href="#cb9-16"></a></span>
<span id="cb9-17"><a href="#cb9-17"></a>    buf</span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="kw">end</span></span></code></pre></div>

</div> <!-- article-content -->

<div id="footer-nav-bar">
<div><a href="How-to-zip-files-with-Msf-Util-EXE.to_zip.html">←prev</a></div><div class="nav-bar-push"><a href=".././Evasion-and-Obfuscation/obfuscation-crandomizer.html">next→</a></div>
</div>

</div> <!-- article-box -->

</div> <!-- trunk-box -->

<div id="my-footer">
<p>Copyright <a href="https://metasploit.com/">Metasploit</a>, 2020</p>
<p><a href="https://join.slack.com/t/metasploit/shared_invite/enQtOTMxMjg5ODY3NDYxLTYyZTVlNDM1ZTI3ZGQ0YTQ0NmI1YjgxMGEwYzFhOWNiZWQ4NDNmNTE1MWNiYzJhMzgwMGY0ZWY2NTY0MjA2M2I">Slack team - metasploit.slack.com</a></p>
<p><a href="https://twitter.com/metasploit">#twitter handle - @metasploit</a></p>
<p><a href="mailto:msfdev@metasploit.com">development questions - msfdev [ @ ] metasploit.com</a></p><br/>
<a href="How-to-use-the-Msf-Exploit-Remote-Tcp-mixin.md">Pandoc-Markdown source for this page</a><br/>
(Docs processed by
<a href="http://www.unexpected-vortices.com/sw/rippledoc/index.html">Rippledoc</a>.)
</div> <!-- my-footer -->

</div> <!-- main-outer-box -->

</body>
</html>
