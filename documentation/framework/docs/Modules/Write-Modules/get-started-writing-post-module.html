<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Metasploit Versions 4, 5" />
  <title>Get started with writing a post module</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../styles.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,700;1,300;1,400&display=swap" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>

<div id="main-outer-box">

<nav class="right">
  <ul>
    <li style="display: inline;"> <a href="https://github.com/rapid7/metasploit-framework/tree/master/documentation/modules" target="_blank">Module Docs</a></li>
    <li style="display: inline;"><a href="https://rapid7.github.io/metasploit-framework/api/" target="_blank">API</a></li>
    <li style="display: inline;"><a href="https://github.com/rapid7/metasploit-framework" target="_blank">Metasploit GitHub</a></li>
     <li style="display: inline;"><a href="../../search.html">Search</a></li>
  </ul>
</nav>

<div id="my-header">
  <a href="{{path-to-index}}">Metasploit Framework</a>
</div>

<div id="trunk-box">

<div id="nav-box">
<p>Contents:</p>
<ul>
<li>Getting-Started/
<ul>
<li><a href="../.././Getting-Started/Installing-Metasploit.html">Installing Metasploit</a></li>
<li><a href="../.././Getting-Started/setting-up-metasploit-dev-enviroment.html">Setting up a Metasploit Developer Environment</a></li>
<li>Contributing/
<ul>
<li><a href="../.././Getting-Started/Contributing/Code-Of-Conduct.html">Contributor Code of Conduct</a></li>
<li><a href="../.././Getting-Started/Contributing/Contributing-to-Metasploit.html">Contributing to Metasploit</a></li>
<li><a href="../.././Getting-Started/Contributing/Guidelines-for-Accepting-Modules-and-Enhancements.html">Guidelines for accepting modules and enhancements</a></li>
<li><a href="../.././Getting-Started/Contributing/Adding-Release-Notes-to-PRs.html">Adding release notes to PRs</a></li>
<li><a href="../.././Getting-Started/Contributing/Landing-Pull-Requests.html">Landing pull requests</a></li>
<li><a href="../.././Getting-Started/Contributing/Keeping-in-sync-with-rapid7-master.html">Keep in sync with master</a></li>
<li><a href="../.././Getting-Started/Contributing/How-to-add-and-update-gems-in-metasploit-framework.html">How to add and update gems</a></li>
<li><a href="../.././Getting-Started/Contributing/How-to-deprecate-a-Metasploit-module.html">How to deprecate a Metasploit module</a></li>
<li><a href="../.././Getting-Started/Contributing/Rolling-back-merges.html">Roll back merges</a></li>
<li><a href="../.././Getting-Started/Contributing/Style-Tips.html">Style Tips</a></li>
<li><a href="../.././Getting-Started/Contributing/Reporting-a-Bug.html">Metasploit Bug Reporting</a></li>
<li><a href="../.././Getting-Started/Contributing/markdown-cheat-sheet.html">Markdown Cheat Sheet</a></li>
</ul></li>
<li>Kali-Linux/
<ul>
<li><a href="../.././Getting-Started/Kali-Linux/How-to-get-Oracle-Support-working-with-Kali-Linux.html">Use Oracle support with Kali Linux</a></li>
</ul></li>
<li><a href="../.././Getting-Started/Contact.html">Contact</a></li>
</ul></li>
<li>Internals/
<ul>
<li><a href="../.././Internals/workspaces.html">Workspaces</a></li>
</ul></li>
<li>Modules/
<ul>
<li><a href="../.././Modules/How-to-use-a-Metasploit-module-appropriately.html">Properly use a module</a></li>
<li><a href="../.././Modules/Module-Documentation.html">Module documentation</a></li>
<li><a href="../.././Modules/Handling-Module-Failures-with-fail_with.html">Handing modules failures with <code>fail_with</code></a></li>
<li><a href="../.././Modules/Running-Private-Modules.html">Run private modules</a></li>
<li><a href="../.././Modules/How-to-do-reporting-or-store-data-in-module-development.html">How to do reporting and store data during module development</a></li>
<li><a href="../.././Modules/Using-ReflectiveDll-Injection.html">Using the ReflectiveDll loader in a Metasploit module</a></li>
<li>Write-Modules/
<ul>
<li><a href="How-to-write-a-module-using-HttpServer-and-HttpClient.html">How to write a module using HTTPServer and HTTPClient</a></li>
<li><a href="Writing-External-Metasploit-Modules.html">Writing External Metasploit Modules</a></li>
<li><a href="get-started-writing-auxillary-module.html">Get started with writing an auxiliary module</a></li>
<li><a href="How-to-write-a-HTTP-LoginScanner-Module.html">How to write a HTTP LoginScanner Module</a></li>
<li><a href="Writing-External-Python-Modules.html">Writing Python Modules for Metasploit</a></li>
<li><strong>Get started with writing a post module</strong></li>
<li><a href="Writing-External-GoLang-Modules.html">Writing external GoLang modules</a></li>
<li><a href="login-scanner.html">Create a Login Scanner Module</a></li>
<li><a href="http-login-scanner.html">How to write a HTTP LoginScanner Module</a></li>
</ul></li>
<li><a href="../.././Modules/module-reference-identifiers.html">Reference Identifiers</a></li>
</ul></li>
<li>Exploits/
<ul>
<li><a href="../.././Exploits/use-exploits.html">Use exploits</a></li>
<li><a href="../.././Exploits/Information-About-Unmet-Browser-Exploit-Requirements.html">Unmet browser exploit requirements</a></li>
<li><a href="../.././Exploits/How-to-use-Powershell-in-an-exploit.html">Add PowerShell mixin to an exploit</a></li>
<li><a href="../.././Exploits/How-to-clean-up-files-using-FileDropper.html">How to clean up files using FileDropper</a></li>
<li><a href="../.././Exploits/How-to-use-PhpEXE-to-exploit-an-arbitrary-file-upload-bug.html">PhpEXE arbitrary file upload</a></li>
<li><a href="../.././Exploits/How-to-use-Railgun-for-Windows-post-exploitation.html">Use Railgun for Windows</a></li>
<li><a href="../.././Exploits/How-to-use-command-stagers.html">Use command stagers</a></li>
<li><a href="../.././Exploits/exploit-ranking.html">Exploit Ranking</a></li>
<li>Write-Exploits/
<ul>
<li><a href="../.././Exploits/Write-Exploits/writing-exploits.html">Get Started Writing an Exploit</a></li>
<li><a href="../.././Exploits/Write-Exploits/How-to-use-WbemExec-for-a-write-privilege-attack-on-Windows.html">Write a privilege attack with WbemExec</a></li>
<li><a href="../.././Exploits/Write-Exploits/How-to-Use-the-FILEFORMAT-mixin-to-create-a-file-format-exploit.html">How to use the FILEFORMAT mixin</a></li>
<li><a href="../.././Exploits/Write-Exploits/How-to-write-a-browser-exploit-using-HttpServer.html">How to write a browser exploit using HTTP Server</a></li>
<li><a href="../.././Exploits/Write-Exploits/How-to-write-a-browser-exploit-using-BrowserExploitServer.html">Write a browser exploit with BrowserExploitServer</a></li>
</ul></li>
</ul></li>
<li>Payloads/
<ul>
<li><a href="../.././Payloads/how-payloads-work.html">How Payloads Work</a></li>
<li><a href="../.././Payloads/payload-debugging.html">Payload Debugging</a></li>
<li><a href="../.././Payloads/Payload-UUID.html">Payload UUID</a></li>
<li>Meterpreter/
<ul>
<li><a href="../.././Payloads/Meterpreter/about-meterpreter.html">About Meterpreter</a></li>
<li><a href="../.././Payloads/Meterpreter/meterpreter-configuration.html">Meterpreter Configuration</a></li>
<li><a href="../.././Payloads/Meterpreter/transport-control.html">Transport Control</a></li>
<li><a href="../.././Payloads/Meterpreter/Meterpreter-Reliable-Network-Communication.html">Reliable Network Communication</a></li>
<li><a href="../.././Payloads/Meterpreter/Meterpreter-Unicode-Support.html">Unicode Support</a></li>
<li><a href="../.././Payloads/Meterpreter/Meterpreter-HTTP-Communication.html">Meterpreter HTTP communication</a></li>
<li><a href="../.././Payloads/Meterpreter/Meterpreter-Sleep-Control.html">Sleep Control</a></li>
<li><a href="../.././Payloads/Meterpreter/Meterpreter-Paranoid-Mode.html">Paranoid Mode</a></li>
<li><a href="../.././Payloads/Meterpreter/The-ins-and-outs-of-HTTP-and-HTTPS-communications-in-Meterpreter-and-Metasploit-Stagers.html">HTTP and HTTPS communication</a></li>
<li><a href="../.././Payloads/Meterpreter/Python-Extension.html">Python Extension</a></li>
</ul></li>
<li>msfvenom/
<ul>
<li><a href="../.././Payloads/msfvenom/How-to-use-msfvenom.html">How to use msfvenom</a></li>
</ul></li>
<li>Shell/
<ul>
<li><a href="../.././Payloads/Shell/How-to-use-a-reverse-shell-in-Metasploit.html">How to use a reverse shell</a></li>
</ul></li>
</ul></li>
<li>Utilities/
<ul>
<li><a href="../.././Utilities/complier-windows-c.html">How to use Metasploit Framework Compiler Windows to compile C code</a></li>
<li><a href="../.././Utilities/oracle-support-kali-linux.html">Oracle Support working with Kali Linux</a></li>
<li><a href="../.././Utilities/How-to-zip-files-with-Msf-Util-EXE.to_zip.html">How to zip files with Msf::Util::EXE.to_zip</a></li>
<li><a href="../.././Utilities/How-to-use-the-Msf-Exploit-Remote-Tcp-mixin.html">How to use the Msf::Exploit::Remote::Tcp mixin</a></li>
</ul></li>
<li>Evasion-and-Obfuscation/
<ul>
<li><a href="../.././Evasion-and-Obfuscation/obfuscation-crandomizer.html">CRandomizer</a></li>
<li><a href="../.././Evasion-and-Obfuscation/How-to-obfuscate-JavaScript-in-Metasploit.html">Obfuscate JavaScript</a></li>
<li><a href="../.././Evasion-and-Obfuscation/How-to-use-Metasploit-Framework-Obfuscation-CRandomizer.html">How to use CRandomizer</a></li>
</ul></li>
<li>API/
<ul>
<li><a href="../.././API/Metasploit-Web-Service.html">Metasploit web service</a></li>
<li><a href="../.././API/Metasploit-as-a-service.html">Metasploit as a service</a></li>
</ul></li>
<li>Debugging/
<ul>
<li><a href="../.././Debugging/How-to-log-in-Metasploit.html">Log Files in Metasploit</a></li>
<li><a href="../.././Debugging/Why-CVE-is-not-available.html">Why is a CVE Not Available?</a></li>
</ul></li>
<li><a href="../.././external-resources.html">Community Resources</a></li>
</ul>

</div>

<div id="article-box">

<div id="header-nav-bar">
<div><a href="Writing-External-Python-Modules.html">←prev</a></div><div class="nav-bar-push"><a href="Writing-External-GoLang-Modules.html">next→</a></div>
</div>

<div id="article-content">
<header id="title-block-header">
<h1 class="title">Get started with writing a post module</h1>
<p class="author">Metasploit Versions 4, 5</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#plan-your-module">Plan your module</a>
<ul>
<li><a href="#categories-of-post-modules">Categories of post modules</a></li>
<li><a href="#session-object">Session object</a></li>
<li><a href="#the-msfpost-mixin">The Msf::Post Mixin</a></li>
<li><a href="#template">Template</a></li>
<li><a href="#basic-git-commands">Basic git commands</a></li>
<li><a href="#references">References</a></li>
</ul></li>
</ul>
</nav>
<p>Post module development is a challenge to your programming skills. It’s not like writing a memory corruption based exploit, where technically speaking is usually about crafting a malicious input - a string. A post module is more about proper module design, practical knowledge in Ruby and the Metasploit library. It’s also a very valuable skill to have, because if you don’t know what to do after popping a shell, what’s the point of the penetration test, right? Also, what if a module doesn’t work? Are you willing to wait days, weeks, or maybe even months for someone else to fix it for you? Probably not. If you know how to do it yourself, you can probably fix it a lot sooner, and continue with your pentest and do more things. So learn post module development! It’s good for you, and your career.</p>
<h2 id="plan-your-module">Plan your module</h2>
<p>Just like writing a software, before you start coding you should have a clear and specific goal for what your post module does. It’s never a good idea to have multiple functionalities in a single module. For example: having it steal the network configuration files, steal passwd, hashes, shell history, etc. Instead, you should break it down into multiple modules.</p>
<p>You should also think about what session types to support: meterpreter, or shell. Ideally, support both. But if you have to choose between the two, on Windows you should favor Windows Meterpreter. On Linux, the shell session type has been a stronger candidate than the Linux Meterpreter, but hopefully this will change in the near future. For platforms that don’t have a Meterpreter, obviously your only choice is a shell.</p>
<p>Another important thing is to think about how your module will perform on different distributions/systems. For example, say you want to run a <code>ifconfig</code> command on Linux. On Ubuntu it’s a no-brainer, simply run the <code>ifconfig</code> command. Well, a different Linux distro might not actually know what you’re asking, so you have to be more specific and do <code>/sbin/ifconfig</code> instead. Same thing with Windows. Is it <code>C:\WINDOWS\</code> or <code>C:\WinNT</code>? It’s both. Is it <code>C:\Documents and Settings\[User name]</code>, or <code>C:\Users\[User name]</code>? Both, depends on that Windows version. A better solution to that would be use an environment variable :-)</p>
<p>Always do your homework, and contain as many scenarios you can think of. And most importantly, get your VMs and TEST!</p>
<h3 id="categories-of-post-modules">Categories of post modules</h3>
<p>Post modules are categorized based on their behavior. For example, if it collects data, naturally it goes to the “gather” category. If it adds/updates/or removes an user, it belongs to “manage”. Here’s a list as a reference:</p>
<table>
<colgroup>
<col style="width: 42%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="header">
<th>Category</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>gather</strong></td>
<td>Modules that involve data gathering/collecting/enumeration.</td>
</tr>
<tr class="even">
<td><strong>gather/credentials</strong></td>
<td>Modules that steal credentials.</td>
</tr>
<tr class="odd">
<td><strong>gather/forensics</strong></td>
<td>Modules that involve forensics data gathering.</td>
</tr>
<tr class="even">
<td><strong>manage</strong></td>
<td>Modules that modifies/operates/manipulates something on the system. Session management related tasks such as migration, injection also go here.</td>
</tr>
<tr class="odd">
<td><strong>recon</strong></td>
<td>Modules that will help you learn more about the system in terms of reconnaissance, but not about data stealing. Understand this is not the same as “gather” type modules.</td>
</tr>
<tr class="even">
<td><strong>wlan</strong></td>
<td>Modules that are for WLAN related tasks.</td>
</tr>
<tr class="odd">
<td><strong>escalate</strong></td>
<td>This is deprecated, but the modules remain there due to popularity. This used to be the place for privilege escalation modules. All privilege escalation modules are no longer considered as post modules, they’re now exploits.</td>
</tr>
<tr class="even">
<td><strong>capture</strong></td>
<td>Modules that involve monitoring something for data collection. For example: key logging.</td>
</tr>
</tbody>
</table>
<h3 id="session-object">Session object</h3>
<p>So you know how in Lord of the Rings, people are totally obsessed with the One Ring? Well, that’s how it is with the session object. The one object you cannot live without, it’s your precious. All post modules and other related mixins basically are built on top of the session object, because it knows everything about the compromised host, and allows you to command it.</p>
<p>You can use the <code>session</code> method to access the session object, or its alias <code>client</code>. The best way to interact with one is via irb, here’s an example of how:</p>
<pre><code>msf exploit(handler) &gt; run

[*] Started reverse handler on 192.168.1.64:4444 
[*] Starting the payload handler...
[*] Sending stage (769536 bytes) to 192.168.1.106
[*] Meterpreter session 1 opened (192.168.1.64:4444 -&gt; 192.168.1.106:55157) at 2014-07-31 17:59:36 -0500

meterpreter &gt; irb
[*] Starting IRB shell
[*] The &#39;client&#39; variable holds the meterpreter client

&gt;&gt; session.class
=&gt; Msf::Sessions::Meterpreter_x86_Win</code></pre>
<p>At this point you have the power to rule them all. But notice that the above example is a <code>Msf::Sessions::Meterpreter_x86_Win</code> object. There are actually several more different ones: command_shell.rb, meterpreter_php.rb, meterpreter_java.rb, meterpreter_x86_linux.rb, etc. Each behaves differently so it’s actually kind of difficult to explain them all, but they are defined in the <a href="https://github.com/rapid7/metasploit-framework/tree/master/lib/msf/base/sessions">lib/msf/base/sessions/</a> directory so you can see how they work. Or you can play with one since you’re already in the irb prompt.</p>
<p>In Ruby, there are two object methods that are handy for debugging purposes. The first is <code>methods</code>, which will list all the public and protected methods from that object:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb2-1"><a href="#cb2-1"></a>session.methods</span></code></pre></div>
<p>The other one is <code>inspect</code>, which returns a string of a human-readable representation of the object:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb3-1"><a href="#cb3-1"></a>session.inspect</span></code></pre></div>
<p>You can also look at <a href="https://github.com/rapid7/metasploit-framework/tree/master/modules/post">other current post modules</a> and see how they use their session object.</p>
<h3 id="the-msfpost-mixin">The Msf::Post Mixin</h3>
<p>As we explained, most post module mixins are built on top of the session object, and there are many out there. However, there is a main one you obviously cannot live without: the <code>Msf::Post</code> mixin. When you create a post module with this mixin, a lot of other mixins are also already included for all kinds of scenarios, to be more specific:</p>
<ul>
<li><strong><a href="https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/post/common.rb">msf/core/post/common</a></strong> - Common methods post modules use, for example: <code>cmd_exec</code>.</li>
<li><strong><a href="https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/post_mixin.rb">msf/core/post_mixin</a></strong> - Keeps track of the session state.</li>
<li><strong><a href="https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/post/file.rb">msf/core/post/file</a></strong> - File system related methods.</li>
<li><strong><a href="https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/post/webrtc.rb">msf/core/post/webrtc</a></strong> - Uses WebRTC to interact with the target machine’s webcam.</li>
<li><strong><a href="https://github.com/rapid7/metasploit-framework/tree/master/lib/msf/core/post/linux">msf/core/post/linux</a></strong> - There actually isn’t a lot going on, just <code>get_sysinfo</code> and <code>is_root?</code> specifically for Linux.</li>
<li><strong><a href="https://github.com/rapid7/metasploit-framework/tree/master/lib/msf/core/post/osx">msf/core/post/osx</a></strong> - <code>get_sysinfo</code>, <code>get_users</code>, <code>get_system_accounts</code>, <code>get_groups</code>, and methods for operating the target machine’s webcam.</li>
<li><strong><a href="https://github.com/rapid7/metasploit-framework/tree/master/lib/msf/core/post/solaris">msf/core/post/solaris</a></strong> - Pretty much like the linux mixin. Same methods, but for Solaris.</li>
<li><strong><a href="https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/post/unix.rb">msf/core/post/unix</a></strong> - <code>get_users</code>, <code>get_groups</code>, <code>enum_user_directories</code></li>
<li><strong><a href="https://github.com/rapid7/metasploit-framework/tree/master/lib/msf/core/post/windows">msf/core/post/windows</a></strong> - Most of the development time are spent here. From Windows account management, event log, file info, Railgun, LDAP, netapi, powershell, registry, wmic, services, etc.</li>
</ul>
<h3 id="template">Template</h3>
<p>Here we have a post module template. As you can see, there are some required fields that need to be filled. We’ll explain each:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">##</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># This module requires Metasploit: https://metasploit.com/download</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co"># Current source: https://github.com/rapid7/metasploit-framework</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">##</span></span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="kw">class</span> <span class="dt">MetasploitModule</span> &lt; <span class="dt">Msf</span>::<span class="dt">Post</span></span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a>  <span class="kw">def</span> initialize(info = {})</span>
<span id="cb4-9"><a href="#cb4-9"></a>    <span class="dv">super</span>(update_info(info,</span>
<span id="cb4-10"><a href="#cb4-10"></a>        <span class="st">&#39;Name&#39;</span>          =&gt; <span class="st">&#39;[Platform] [Module Category] [Software] [Function]&#39;</span>,</span>
<span id="cb4-11"><a href="#cb4-11"></a>        <span class="st">&#39;Description&#39;</span>   =&gt;<span class="ot"> %q{</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="st">          Say something that the user might want to know.</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="st">        </span><span class="ot">}</span>,</span>
<span id="cb4-14"><a href="#cb4-14"></a>        <span class="st">&#39;License&#39;</span>       =&gt; <span class="dt">MSF_LICENSE</span>,</span>
<span id="cb4-15"><a href="#cb4-15"></a>        <span class="st">&#39;Author&#39;</span>        =&gt; [ <span class="st">&#39;Name&#39;</span> ],</span>
<span id="cb4-16"><a href="#cb4-16"></a>        <span class="st">&#39;Platform&#39;</span>      =&gt; [ <span class="st">&#39;win&#39;</span>, <span class="st">&#39;linux&#39;</span>, <span class="st">&#39;osx&#39;</span>, <span class="st">&#39;unix&#39;</span>, <span class="st">&#39;bsd&#39;</span>, <span class="st">&#39;solaris&#39;</span> ],</span>
<span id="cb4-17"><a href="#cb4-17"></a>        <span class="st">&#39;SessionTypes&#39;</span>  =&gt; [ <span class="st">&#39;meterpreter&#39;</span>, <span class="st">&#39;shell&#39;</span> ]</span>
<span id="cb4-18"><a href="#cb4-18"></a>    ))</span>
<span id="cb4-19"><a href="#cb4-19"></a>  <span class="kw">end</span></span>
<span id="cb4-20"><a href="#cb4-20"></a></span>
<span id="cb4-21"><a href="#cb4-21"></a>  <span class="kw">def</span> run</span>
<span id="cb4-22"><a href="#cb4-22"></a>    <span class="co"># Main method</span></span>
<span id="cb4-23"><a href="#cb4-23"></a>  <span class="kw">end</span></span>
<span id="cb4-24"><a href="#cb4-24"></a></span>
<span id="cb4-25"><a href="#cb4-25"></a><span class="kw">end</span></span></code></pre></div>
<p>The <strong>Name</strong> field should begin with a platform, such as: Multi, Windows, Linux, OS X, etc. Followed by the module’s category, such as: Gather, Manage, Recon, Capture, Wlan. Followed by the name of the software, and then finally a few wrods that describe the functionality of the module. A naming example: “Multi Gather RndFTP Credential Enumeration”.</p>
<p>The <strong>Description</strong> field should explain what the module does, things to watch out for, specific requirements, the more the better. The goal is to let the user understand what he’s using without the need to actually read the module’s source and figure things out. And trust me, most of them don’t.</p>
<p>The <strong>Author</strong> field is where you put your name. The format should be “Name <email>”. If you want to have your Twitter handle there, leave it as a comment, for example: “Name <email> # handle”</p>
<p>The <strong>Platform</strong> field indicates what platforms are supported, for example: win, linux, osx, unix, bsd.</p>
<p>The <strong>SessionTypes</strong> field should be either meterpreter, or shell. You should try to support both.</p>
<p>And finally, the <code>run</code> method is like your main method. Start writing your code there.</p>
<h3 id="basic-git-commands">Basic git commands</h3>
<p>Metasploit no longer uses svn for source code management, instead we use git, so knowing some tricks with git go a long way. We’re not here to lecture you about how awesome git is, we know it has a learning curve and it’s not surprising to find new users making mistakes. Every once a while, your git “rage” will kick in, and we understand. However, it’s important for you to take advantage of branching.</p>
<p>Every time you make a module, or make some changes to existing code, you should not do so on the default master branch. Why? Because when you do a <code>msfupdate</code>, which is Metasploit’s utility for updating your repository, it will do a git reset before merging the changes, and all your code go bye-bye.</p>
<p>Another mistake people tend to do is have all the changes on <code>master</code> before submitting a pull request. This is a bad idea, because most likely you’re submitting other crap you don’t intend to change, and/or you’re probably asking us to merge other unnecessary commit history when there only needs to be one commit. Thanks for contributing your module to the community, but no thanks to your crazy commit history.</p>
<p>So as a habit, when you want to make something new, or change something, begin with a new branch that’s up to date to master. First off, make sure you’re on master. If you do a <code>git status</code> it will tell you what branch you’re currently on:</p>
<pre><code>$ git status
# On branch upstream-master
nothing to commit, working directory clean</code></pre>
<p>Ok, now do a <code>git pull</code> to download the latest changes from Metasploit:</p>
<pre><code>$ git pull
Already up-to-date.</code></pre>
<p>At this point, you’re ready to start a new branch. In this case, we’ll name our new branch “my_awesome_branch”:</p>
<pre><code>$ git checkout -b my_awesome_module
Switched to a new branch &#39;my_awesome_module&#39;</code></pre>
<p>And then you can go ahead and add that module. Make sure it’s in the appropriate path:</p>
<pre><code>$ git add [module path]</code></pre>
<p>When you decide to save the changes, commit (if there’s only one module, you can do <code>git commit -a</code> too so you don’t have to type the module path. Note <code>-a</code> really means EVERYTHING):</p>
<pre><code>$ git commit [module path]</code></pre>
<p>When you’re done, push your changes, which will upload your code to your remote branch “my_awesome_branch”. You must push your changes in order to submit the pull request, or share it with others on the Internet.</p>
<pre><code>$ git push origin my_awesome_branch</code></pre>
<h3 id="references">References</h3>
<p>https://github.com/rapid7/metasploit-framework/tree/master/modules/post</p>
<p>https://github.com/rapid7/metasploit-framework/tree/master/lib/msf/core/post</p>

</div> <!-- article-content -->

<div id="footer-nav-bar">
<div><a href="Writing-External-Python-Modules.html">←prev</a></div><div class="nav-bar-push"><a href="Writing-External-GoLang-Modules.html">next→</a></div>
</div>

</div> <!-- article-box -->

</div> <!-- trunk-box -->

<div id="my-footer">
<p>Copyright <a href="https://metasploit.com/">Metasploit</a>, 2020</p>
<p><a href="https://join.slack.com/t/metasploit/shared_invite/enQtOTMxMjg5ODY3NDYxLTYyZTVlNDM1ZTI3ZGQ0YTQ0NmI1YjgxMGEwYzFhOWNiZWQ4NDNmNTE1MWNiYzJhMzgwMGY0ZWY2NTY0MjA2M2I">Slack team - metasploit.slack.com</a></p>
<p><a href="https://twitter.com/metasploit">#twitter handle - @metasploit</a></p>
<p><a href="mailto:msfdev@metasploit.com">development questions - msfdev [ @ ] metasploit.com</a></p>
<p> This site is built with <a href="http://www.unexpected-vortices.com/sw/rippledoc/index.html">Rippledoc</a>, <a href="https://lunrjs.com/">Lunr</a>, and <a href="https://github.com/BLE-LTER/Lunr-Index-and-Search-for-Static-Sites">BLE-LTER</a>.<br/>
<a href="get-started-writing-post-module.md">Pandoc-Markdown source for this page</a><br/>
(Docs processed by
<a href="http://www.unexpected-vortices.com/sw/rippledoc/index.html">Rippledoc</a>.)
</div> <!-- my-footer -->

</div> <!-- main-outer-box -->

</body>
</html>
